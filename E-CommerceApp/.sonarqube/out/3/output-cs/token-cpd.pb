Ô
ZC:\Dev\Projects\.NET Work\E-CommerceApp\E-CommerceApp\Controllers\Admin\RolesController.cs
	namespace 	
E_CommerceApp
 
. 
Controllers #
.# $
Admin$ )
{ 
[

 
ApiController

 
]

 
[ 
Route 

(
 
$str 
) 
] 
[ 
	Authorize 
( 
Roles 
= 
$str #
)# $
]$ %
public 

class 
RolesController  
:! "
ControllerBase# 1
{ 
private 
RoleManager 
< 
IdentityRole (
>( )
_roleManager* 6
;6 7
private 
readonly 
UserManager $
<$ %
	ECommUser% .
>. /
_userManager0 <
;< =
public 
RolesController 
( 
RoleManager *
<* +
IdentityRole+ 7
>7 8
roleManager9 D
,D E
UserManagerF Q
<Q R
	ECommUserR [
>[ \
userManager] h
)h i
{ 	
_roleManager 
= 
roleManager &
;& '
_userManager 
= 
userManager &
;& '
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
IdentityRole' 3
>3 4
>4 5
GetAll6 <
(< =
)= >
{ 	
var 
roles 
= 
_roleManager $
.$ %
Roles% *
.* +
ToList+ 1
(1 2
)2 3
;3 4
if 
( 
roles 
== 
null 
) 
return 
NotFound 
(  
)  !
;! "
return 
Ok 
( 
roles 
) 
; 
} 	
[!! 	
HttpPost!!	 
]!! 
["" 	
Route""	 
("" 
$str"" 
)"" 
]"" 
public## 
async## 
Task## 
<## 
ActionResult## &
>##& '

AssignUser##( 2
(##2 3
[##3 4
FromBody##4 <
]##< =
string##> D
roleId##E K
,##K L
Guid##M Q
userId##R X
)##X Y
{$$ 	
var%% 
user%% 
=%% 
await%% 
_userManager%% )
.%%) *
FindByIdAsync%%* 7
(%%7 8
userId%%8 >
.%%> ?
ToString%%? G
(%%G H
)%%H I
)%%I J
;%%J K
var&& 
role&& 
=&& 
await&& 
_roleManager&& )
.&&) *
FindByIdAsync&&* 7
(&&7 8
roleId&&8 >
)&&> ?
;&&? @
var'' 
result'' 
='' 
_userManager'' %
.''% &
AddToRoleAsync''& 4
(''4 5
user''5 9
,''9 :
role''; ?
.''? @
Name''@ D
)''D E
;''E F
return)) 
Ok)) 
()) 
))) 
;)) 
}** 	
}++ 
},, Ô
WC:\Dev\Projects\.NET Work\E-CommerceApp\E-CommerceApp\Controllers\CategoryController.cs
	namespace		 	

E_Commerce		
 
.		 
API		 
.		 
Controllers		 $
{

 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
[ 
	Authorize 
] 
public 

class 
CategoryController #
:$ %
ControllerBase& 4
{ 
public 
IUnitOfWork 
_unitOfWork &
;& '
public 
CategoryController !
(! "
IUnitOfWork" -

unitOfWork. 8
)8 9
{ 	
_unitOfWork 
= 

unitOfWork $
;$ %
} 	
[ 	
AllowAnonymous	 
] 
[ 	
HttpGet	 
] 
public 
IActionResult 
GetAll #
(# $
)$ %
{ 	
List 
< 
Category 
> 
_categories &
=' (
_unitOfWork) 4
.4 5

Categories5 ?
.? @
GetAll@ F
(F G
)G H
.H I
ToListI O
(O P
)P Q
;Q R
if 
( 
! 
_categories 
. 
Any  
(  !
)! "
)" #
return$ *

BadRequest+ 5
(5 6
)6 7
;7 8
return 
Ok 
( 
_categories !
)! "
;" #
} 	
[   	
HttpPost  	 
]   
public!! 
IActionResult!! 
Post!! !
(!!! "
[!!" #
FromBody!!# +
]!!+ ,
Category!!- 5
categoryInput!!6 C
)!!C D
{"" 	
try## 
{$$ 
_unitOfWork(( 
.(( 

Categories(( &
.((& '
Post((' +
(((+ ,
categoryInput((, 9
)((9 :
;((: ;
_unitOfWork)) 
.)) 
Save))  
())  !
)))! "
;))" #
}** 
catch++ 
(++ 
	Exception++ 
)++ 
{,, 
return.. 

BadRequest.. !
(..! "
).." #
;..# $
}// 
return00 
Ok00 
(00 
categoryInput00 #
)00# $
;00$ %
}33 	
[66 	
	HttpPatch66	 
]66 
public77 
IActionResult77 
Patch77 "
(77" #
[77# $
FromBody77$ ,
]77, -
Category77. 6
categoryInput777 D
)77D E
{88 	
return:: 
Ok:: 
(:: 
):: 
;:: 
};; 	
[== 	

HttpDelete==	 
]== 
public>> 
IActionResult>> 
Delete>> #
(>># $
[>>$ %
	FromQuery>>% .
]>>. /
Guid>>0 4
id>>5 7
)>>7 8
{?? 	
returnAA 
OkAA 
(AA 
)AA 
;AA 
}BB 	
}HH 
}II é9
TC:\Dev\Projects\.NET Work\E-CommerceApp\E-CommerceApp\Controllers\ImageController.cs
	namespace 	
E_CommerceApp
 
. 
Controllers #
{ 
[ 
Route 

(
 
$str !
)! "
]" #
[		 
ApiController		 
]		 
public

 

class

 
ImageController

  
:

! "
ControllerBase

# 1
{ 
private 
IWebHostEnvironment #
_webHostEnvironment$ 7
;7 8
public 
IUnitOfWork 
_unitOfWork &
;& '
public 
ImageController 
( 
IWebHostEnvironment 2
webHostEnvironment3 E
,E F
IUnitOfWorkG R

unitOfWorkS ]
)] ^
{ 	
_webHostEnvironment 
=  !
webHostEnvironment" 4
;4 5
_unitOfWork 
= 

unitOfWork $
;$ %
} 	
[ 	
HttpGet	 
] 
public 
List 
< 
string 
> 
GetImageByProductId /
(/ 0
[0 1
	FromQuery1 :
]: ;
Guid< @
	productIdA J
)J K
{ 	
var 
images 
= 
new 
List !
<! "
string" (
>( )
() *
)* +
;+ ,
string 
ImageUrl 
= 
_webHostEnvironment 1
.1 2
WebRootPath2 =
+> ?
$str@ V
+W X
	productIdY b
.b c
ToStringc k
(k l
)l m
;m n
if 
( 
! 
System 
. 
IO 
. 
	Directory $
.$ %
Exists% +
(+ ,
ImageUrl, 4
)4 5
)5 6
return7 =
new> A
ListB F
<F G
stringG M
>M N
(N O
)O P
;P Q
string 
[ 
] 

imagePaths 
=  !
System" (
.( )
IO) +
.+ ,
	Directory, 5
.5 6
GetFiles6 >
(> ?
ImageUrl? G
)G H
;H I
return 

imagePaths 
. 
ToList $
($ %
)% &
;& '
} 	
[ 	
HttpPost	 
] 
public   
async   
Task   
<   
IActionResult   '
>  ' (
	PostImage  ) 2
(  2 3
[  3 4
	FromQuery  4 =
]  = >
Guid  ? C
	productId  D M
,  M N
[  O P
FromForm  P X
(  X Y
Name  Y ]
=  ^ _
$str  ` g
)  g h
]  h i
List  j n
<  n o
	IFormFile  o x
>  x y
images	  z €
)
  € 
{!! 	
var"" 
product"" 
="" 
_unitOfWork"" %
.""% &
Products""& .
."". /
Get""/ 2
(""2 3
_p""3 5
=>""6 8
_p""9 ;
.""; <
Id""< >
==""? A
	productId""B K
)""K L
;""L M
if## 
(## 
product## 
==## 
null## 
)## 
return##  &
NotFound##' /
(##/ 0
)##0 1
;##1 2
var%% 
i%% 
=%% 
$num%% 
;%% 
foreach&& 
(&& 
var&& 
_file&& 
in&& !
images&&" (
)&&( )
{'' 
string)) 
fileName)) 
=))  !
_file))" '
.))' (
FileName))( 0
;))0 1
var** 
type** 
=** 
Path** 
.**  
GetExtension**  ,
(**, -
fileName**- 5
)**5 6
;**6 7
string++ 
[++ 
]++ 

validTypes++ #
=++$ %
{++& '
$str++( .
,++. /
$str++0 6
,++6 7
$str++8 ?
}++@ A
;++A B
foreach,, 
(,, 
var,, 
	validType,, &
in,,' )

validTypes,,* 4
),,4 5
{-- 
if.. 
(.. 
type.. 
!=.. 
	validType..  )
)..) *
break..+ 0
;..0 1
}// 
string22 
filePath22 
=22  !
_webHostEnvironment22" 5
.225 6
WebRootPath226 A
+22B C
$str22D Z
+22[ \
	productId22] f
.22f g
ToString22g o
(22o p
)22p q
;22q r
if44 
(44 
!44 
System44 
.44 
IO44 
.44 
	Directory44 (
.44( )
Exists44) /
(44/ 0
filePath440 8
)448 9
)449 :
{55 
System66 
.66 
IO66 !
.66! "
	Directory66" +
.66+ ,
CreateDirectory66, ;
(66; <
filePath66< D
)66D E
;66E F
}77 
string99 
	imagePath99  
=99! "
$"99# %
{99% &
filePath99& .
}99. /
$str99/ 6
{996 7
i997 8
}998 9
{999 :
type99: >
}99> ?
"99? @
;99@ A
if;; 
(;; 
System;; 
.;; 
IO;; 
.;; 
	Directory;; '
.;;' (
Exists;;( .
(;;. /
	imagePath;;/ 8
);;8 9
);;9 :
{<< 
System== 
.== 
IO== !
.==! "
	Directory==" +
.==+ ,
Delete==, 2
(==2 3
	imagePath==3 <
)==< =
;=== >
}>> 
using@@ 
(@@ 

FileStream@@ !
stream@@" (
=@@) *
System@@+ 1
.@@1 2
IO@@2 4
.@@4 5
File@@5 9
.@@9 :
Create@@: @
(@@@ A
	imagePath@@A J
)@@J K
)@@K L
{AA 
awaitBB 
_fileBB 
.BB  
CopyToAsyncBB  +
(BB+ ,
streamBB, 2
)BB2 3
;BB3 4
}DD 
productEE 
.EE 
ImagesEE 
.EE 
AddEE "
(EE" #
newEE# &
ImageStorageEE' 3
(EE3 4
newEE4 7
GuidEE8 <
(EE< =
)EE= >
,EE> ?
filePathEE? G
)EEG H
)EEH I
;EEI J
iGG 
++GG 
;GG 
}HH 
_unitOfWorkII 
.II 
SaveII 
(II 
)II 
;II 
returnJJ 
CreatedAtActionJJ "
(JJ" #
nameofJJ# )
(JJ) *
GetImageByProductIdJJ* =
)JJ= >
,JJ> ?
	productIdJJ@ I
)JJI J
;JJJ K
}KK 	
}LL 
}MM >
VC:\Dev\Projects\.NET Work\E-CommerceApp\E-CommerceApp\Controllers\ProductController.cs
	namespace 	

E_Commerce
 
. 
API 
. 
Controllers $
{		 
[

 
ApiController

 
]

 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
ProductController "
:# $
ControllerBase% 3
{ 
private 
IUnitOfWork 
_unitOfWork '
;' (
public 
IWebHostEnvironment "
_webHostEnvironment# 6
{7 8
get9 <
;< =
}> ?
public 
ProductController  
(  !
IUnitOfWork! ,

unitOfWork- 7
,7 8
IWebHostEnvironment9 L
webHostEnvironmentM _
)_ `
{ 	
_unitOfWork 
= 

unitOfWork $
;$ %
_webHostEnvironment 
=  !
webHostEnvironment" 4
;4 5
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
IActionResult 
Get  
(  !
[! "
	FromRoute" +
]+ ,
Guid- 1
id2 4
)4 5
{ 	
var 
product 
= 
_unitOfWork %
.% &
Products& .
.. /
Get/ 2
(2 3
p3 4
=>5 7
p8 9
.9 :
Id: <
=== ?
id@ B
)B C
;C D
if 
( 
product 
== 
null 
)  
return! '
NotFound( 0
(0 1
)1 2
;2 3
return 
Ok 
( 
product 
) 
; 
} 	
[   	
HttpGet  	 
]   
public!! 
IActionResult!! 
GetAll!! #
(!!# $
)!!$ %
{"" 	
var## 
products## 
=## 
_unitOfWork## &
.##& '
Products##' /
.##/ 0
GetAll##0 6
(##6 7
)##7 8
;##8 9
if$$ 
($$ 
products$$ 
==$$ 
null$$  
||$$! #
products$$$ ,
.$$, -
IsNullOrEmpty$$- :
($$: ;
)$$; <
)$$< =
return$$> D
	NoContent$$E N
($$N O
)$$O P
;$$P Q
return%% 
Ok%% 
(%% 
products%% 
)%% 
;%%  
}&& 	
[(( 	
HttpPost((	 
](( 
public)) 
async)) 
Task)) 
<)) 
IActionResult)) '
>))' (
Post))) -
())- .
[)). /
FromBody))/ 7
]))7 8
ProductViewModel))9 I
productInput))J V
)))V W
{** 	
var++ 
newId++ 
=++ 
Guid++ 
.++ 
NewGuid++ $
(++$ %
)++% &
;++& '
var,, 

newProduct,, 
=,, 
new,,  
Product,,! (
(,,( )
),,) *
;,,* +
var-- 

categories-- 
=-- 
new--  
List--! %
<--% &
Category--& .
>--. /
(--/ 0
)--0 1
;--1 2
try.. 
{// 
foreach11 
(11 
Guid11 
catId11 #
in11$ &
productInput11' 3
.113 4
CategoriesId114 @
)11@ A
{22 
var33 
productCategories33 )
=33* +
_unitOfWork33, 7
.337 8

Categories338 B
.33B C
Get33C F
(33F G
p33G H
=>33I K
p33L M
.33M N
Id33N P
==33Q S
catId33T Y
)33Y Z
;33Z [
if44 
(44 
productCategories44 )
!=44* ,
null44- 1
)441 2
{55 

categories66 !
.66! "
Add66" %
(66% &
productCategories66& 7
)667 8
;668 9
}77 
else88 
{99 
throw:: 
new:: !
	Exception::" +
(::+ ,
$str::, E
)::E F
;::F G
};; 
}<< 

newProduct== 
=== 
new==  
Product==! (
(==( )
newId==) .
,==. /
productInput==0 <
,==< =

categories==> H
)==H I
;==I J
_unitOfWork@@ 
.@@ 
Products@@ $
.@@$ %
Post@@% )
(@@) *

newProduct@@* 4
)@@4 5
;@@5 6
_unitOfWorkAA 
.AA 
SaveAA  
(AA  !
)AA! "
;AA" #
}BB 
catchCC 
(CC 
	ExceptionCC 
errCC  
)CC  !
{DD 
returnEE 

BadRequestEE !
(EE! "
errEE" %
.EE% &
MessageEE& -
)EE- .
;EE. /
}FF 
returnHH 
CreatedHH 
(HH 
$"HH 
$strHH %
{HH% &
newIdHH& +
}HH+ ,
"HH, -
,HH- .

newProductHH/ 9
)HH9 :
;HH: ;
}II 	
[LL 	
	HttpPatchLL	 
]LL 
publicMM 
IActionResultMM 
PatchMM "
(MM" #
[MM# $
FromBodyMM$ ,
]MM, -
ProductMM. 5
productInputMM6 B
)MMB C
{NN 	
varOO 
productOO 
=OO 
_unitOfWorkOO %
.OO% &
ProductsOO& .
.OO. /
GetOO/ 2
(OO2 3
pOO3 4
=>OO5 7
pOO8 9
.OO9 :
IdOO: <
==OO= ?
productInputOO@ L
.OOL M
IdOOM O
)OOO P
;OOP Q
ifPP 
(PP 
productPP 
==PP 
nullPP 
)PP  
returnPP! '
NotFoundPP( 0
(PP0 1
)PP1 2
;PP2 3
_unitOfWorkQQ 
.QQ 
ProductsQQ  
.QQ  !
PatchQQ! &
(QQ& '
productInputQQ' 3
)QQ3 4
;QQ4 5
_unitOfWorkRR 
.RR 
SaveRR 
(RR 
)RR 
;RR 
returnSS 
OkSS 
(SS 
productInputSS "
)SS" #
;SS# $
}TT 	
[VV 	

HttpDeleteVV	 
]VV 
publicWW 
IActionResultWW 
DeleteWW #
(WW# $
[WW$ %
	FromQueryWW% .
]WW. /
GuidWW0 4
idWW5 7
)WW7 8
{XX 	
varYY 
productYY 
=YY 
_unitOfWorkYY %
.YY% &
ProductsYY& .
.YY. /
GetYY/ 2
(YY2 3
pYY3 4
=>YY5 7
pYY8 9
.YY9 :
IdYY: <
==YY= ?
idYY@ B
)YYB C
;YYC D
ifZZ 
(ZZ 
productZZ 
==ZZ 
nullZZ 
)ZZ  
returnZZ! '
NotFoundZZ( 0
(ZZ0 1
)ZZ1 2
;ZZ2 3
_unitOfWork[[ 
.[[ 
Products[[  
.[[  !
Delete[[! '
([[' (
product[[( /
)[[/ 0
;[[0 1
_unitOfWork\\ 
.\\ 
Save\\ 
(\\ 
)\\ 
;\\ 
return]] 
Ok]] 
(]] 
)]] 
;]] 
}^^ 	
}aa 
}bb š$
UC:\Dev\Projects\.NET Work\E-CommerceApp\E-CommerceApp\Controllers\RatingController.cs
	namespace		 	
E_CommerceApp		
 
.		 
Controllers		 #
{

 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
RatingController !
:" #
ControllerBase$ 2
{ 
private 
readonly 
UserManager $
<$ %
	ECommUser% .
>. /
_userManager0 <
;< =
public 
IUnitOfWork 
_unitOfWork &
;& '
public 
RatingController 
(  
UserManager  +
<+ ,
	ECommUser, 5
>5 6
_userManager7 C
,C D
IUnitOfWorkD O

unitOfWorkP Z
)Z [
{ 	
_unitOfWork 
= 

unitOfWork $
;$ %
} 	
[ 	
HttpGet	 
] 
public 
IActionResult 
GetByProductId +
(+ ,
Guid, 0
	ProductId1 :
): ;
{ 	
try 
{ 
var 
_product 
= 
_unitOfWork *
.* +
Products+ 3
.3 4
Get4 7
(7 8
_P8 :
=>; =
_P> @
.@ A
IdA C
==D F
	ProductIdG P
)P Q
;Q R
if 
( 
_product 
== 
null  $
)$ %
throw& +
new, /
	Exception0 9
(9 :
$str: E
)E F
;F G
var   
ratings   
=   
_product   &
.  & '
Ratings  ' .
;  . /
return!! 
Ok!! 
(!! 
ratings!! !
)!!! "
;!!" #
}"" 
catch## 
(## 
	Exception## 
err##  
)##  !
{$$ 
if%% 
(%% 
err%% 
.%% 
Message%% 
==%%  "
$str%%# .
)%%. /
return%%0 6
NotFound%%7 ?
(%%? @
)%%@ A
;%%A B
return&& 

BadRequest&& !
(&&! "
err&&" %
.&&% &
Message&&& -
)&&- .
;&&. /
}'' 
}(( 	
[** 	
HttpPost**	 
]** 
[++ 	
	Authorize++	 
]++ 
public,, 
async,, 
Task,, 
<,, 
IActionResult,, '
>,,' (
CreateRating,,) 5
(,,5 6
[,,6 7
FromBody,,7 ?
],,? @
RatingViewmodel,,A P
rating,,Q W
),,W X
{-- 	
try.. 
{// 
var00 
currentUser00 
=00  !
await00" '
_userManager00( 4
.004 5
GetUserAsync005 A
(00A B
User00B F
)00F G
;00G H
Rating11 
_rating11 
=11  
new11! $
Rating11% +
(11+ ,
id22 
:22 
new22 
Guid22  
(22  !
)22! "
,22" #
ratingStars33 
:33  
rating33! '
.33' (
Stars33( -
,33- .
comment44 
:44 
rating44 #
.44# $
Comment44$ +
,44+ ,
userName55 
:55 
$"55  
{55  !
currentUser55! ,
.55, -
	FirstName55- 6
}556 7
$str557 8
{558 9
currentUser559 D
.55D E
LastName55E M
}55M N
"55N O
)66 
;66 
_unitOfWork77 
.77 
Ratings77 #
.77# $
Post77$ (
(77( )
_rating77) 0
)770 1
;771 2
return88 
CreatedAtAction88 &
(88& '
nameof88' -
(88- .
Rating88. 4
)884 5
,885 6
rating887 =
)88= >
;88> ?
}99 
catch:: 
(:: 
	Exception:: 
err::  
)::  !
{;; 
return<< 

BadRequest<< !
(<<! "
err<<" %
.<<% &
Message<<& -
)<<- .
;<<. /
}== 
}>> 	
}?? 
}@@ “7
SC:\Dev\Projects\.NET Work\E-CommerceApp\E-CommerceApp\Controllers\UserController.cs
	namespace 	
E_CommerceApp
 
. 
Controllers #
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
UserController 
:  !
ControllerBase" 0
{ 
public 
IIdentityService 
_identityService  0
{1 2
get3 6
;6 7
}8 9
public 
UserController 
( 
IIdentityService .
identityService/ >
)> ?
{ 	
_identityService 
= 
identityService .
;. /
} 	
[ 	
Route	 
( 
$str 
) 
] 
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
LoginResponse' 4
>4 5
>5 6
	LoginPost7 @
(@ A
[A B
FromBodyB J
]J K
LoginRequestL X
loginRequestY e
)e f
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
return% +

BadRequest, 6
(6 7

ModelState7 A
)A B
;B C
var 
result 
= 
await 
_identityService /
./ 0
	LoginUser0 9
(9 :
loginRequest: F
)F G
;G H
if 
( 
result 
. 
Success 
) 
return  &
Ok' )
() *
result* 0
)0 1
;1 2
else   
return   
Unauthorized   $
(  $ %
result  % +
)  + ,
;  , -
}"" 	
[$$ 	
	Authorize$$	 
]$$ 
[%% 	
Route%%	 
(%% 
$str%% 
)%% 
]%%  
[&& 	
HttpPost&&	 
]&& 
public'' 
async'' 
Task'' 
<'' 
ActionResult'' &
<''& '
LoginResponse''' 4
>''4 5
>''5 6!
LoginWithRefreshToken''7 L
(''L M
)''M N
{(( 	
var** 
identity** 
=** 
HttpContext** &
.**& '
User**' +
.**+ ,
Identity**, 4
as**5 7
ClaimsIdentity**8 F
;**F G
var-- 
	userEmail-- 
=-- 
identity-- $
?--$ %
.--% &
	FindFirst--& /
(--/ 0

ClaimTypes--0 :
.--: ;
Email--; @
)--@ A
?--A B
.--B C
Value--C H
;--H I
if// 
(// 
	userEmail// 
==// 
null// !
)//! "
return//# )

BadRequest//* 4
(//4 5
)//5 6
;//6 7
var11 
result11 
=11 
await11 
_identityService11 /
.11/ 0 
LoginWithoutPassword110 D
(11D E
	userEmail11E N
)11N O
;11O P
if22 
(22 
result22 
.22 
Success22 
)22 
return33 
Ok33 
(33 
result33  
)33  !
;33! "
return55 
Unauthorized55 
(55  
result55  &
)55& '
;55' (
}66 	
[88 	
Route88	 
(88 
$str88 
)88 
]88 
[99 	
HttpPost99	 
]99 
public:: 
async:: 
Task:: 
<:: 
ActionResult:: &
<::& '
RegisterResponse::' 7
>::7 8
>::8 9
RegisterPost::: F
(::F G
[::G H
FromBody::H P
]::P Q
RegisterRequest::R a
registerRequest::b q
)::q r
{;; 	
if<< 
(<< 
!<< 

ModelState<< 
.<< 
IsValid<< "
)<<" #
return<<$ *

BadRequest<<+ 5
(<<5 6

ModelState<<6 @
)<<@ A
;<<A B
var>> 
result>> 
=>> 
await>> 
_identityService>> /
.>>/ 0
RegisterUser>>0 <
(>>< =
registerRequest>>= L
)>>L M
;>>M N
if?? 
(?? 
result?? 
.?? 
Success?? 
)?? 
return?? %
Ok??& (
(??( )
result??) /
)??/ 0
;??0 1
else@@ 
return@@ 

BadRequest@@ "
(@@" #
result@@# )
)@@) *
;@@* +
}AA 	
[CC 	
RouteCC	 
(CC 
$strCC 
)CC 
]CC 
[DD 	
HttpPostDD	 
]DD 
publicEE 
asyncEE 
TaskEE 
<EE 
ActionResultEE &
<EE& '
	ECommUserEE' 0
>EE0 1
>EE1 2
GetUserByEmailEE3 A
(EEA B
[EEB C
FromBodyEEC K
]EEK L
stringEEM S
emailEET Y
)EEY Z
{FF 	
varGG 
userGG 
=GG 
awaitGG 
_identityServiceGG -
.GG- .

GetByEmailGG. 8
(GG8 9
emailGG9 >
)GG> ?
;GG? @
ifHH 
(HH 
userHH 
==HH 
nullHH 
)HH 
returnHH $
NotFoundHH% -
(HH- .
)HH. /
;HH/ 0
returnII 
OkII 
(II 
userII 
)II 
;II 
}JJ 	
[LL 	
RouteLL	 
(LL 
$strLL 
)LL 
]LL 
[MM 	
HttpPostMM	 
]MM 
publicNN 
asyncNN 
TaskNN 
<NN 
ActionResultNN &
<NN& '
ListNN' +
<NN+ ,
	ECommUserNN, 5
>NN5 6
>NN6 7
>NN7 8
GetEmployeesNN9 E
(NNE F
)NNF G
{OO 	
varPP 
usersPP 
=PP 
awaitPP 
_identityServicePP .
.PP. /
GetNonDefaultUsersPP/ A
(PPA B
)PPB C
;PPC D
ifQQ 
(QQ 
usersQQ 
==QQ 
nullQQ 
)QQ 
returnQQ %
NotFoundQQ& .
(QQ. /
)QQ/ 0
;QQ0 1
returnRR 
OkRR 
(RR 
usersRR 
)RR 
;RR 
}SS 	
}TT 
}UU ‰,
@C:\Dev\Projects\.NET Work\E-CommerceApp\E-CommerceApp\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
options &
=>' )
{ 
options 
. !
AddSecurityDefinition !
(! "
$str" *
,* +
new, /!
OpenApiSecurityScheme0 E
{ 
Name 
= 
$str 
, 
In 

= 
ParameterLocation 
. 
Header %
,% &
Type 
= 
SecuritySchemeType !
.! "
ApiKey" (
,( )
Scheme 
= 
$str 
} 
) 
; 
options 
. "
AddSecurityRequirement "
(" #
new# &&
OpenApiSecurityRequirement' A
(A B
)B C
{ 
{ 	
new   !
OpenApiSecurityScheme   %
{!! 
	Reference"" 
="" 
new"" 
OpenApiReference""  0
{## 
Type$$ 
=$$ 
ReferenceType$$ (
.$$( )
SecurityScheme$$) 7
,$$7 8
Id%% 
=%% 
$str%% !
}&& 
,&& 
Scheme'' 
='' 
$str'' !
,''! "
Name(( 
=(( 
$str(( 
,((  
In)) 
=)) 
ParameterLocation)) &
.))& '
Header))' -
,))- .
}** 
,** 
new++ 
List++ 
<++ 
string++ 
>++ 
(++ 
)++ 
},, 	
}.. 
).. 
;.. 
}// 
)// 
;// 
builder33 
.33 
Services33 
.33 
	AddScoped33 
<33 
IIdentityService33 +
,33+ ,
IdentityService33- <
>33< =
(33= >
)33> ?
;33? @
builder44 
.44 
Services44 
.44 
AddAuthentication44 "
(44" #
builder44# *
.44* +
Configuration44+ 8
)448 9
;449 :
builder66 
.66 
Services66 
.66 
AddDbContext66 
<66  
ApplicationDbContext66 2
>662 3
(663 4
options664 ;
=>66; =
options77 
.77 
UseSqlServer77 
(77 
builder77  
.77  !
Configuration77! .
.77. /
GetConnectionString77/ B
(77B C
$str77C N
)77N O
)77O P
)77P Q
;77Q R
builder:: 
.:: 
Services:: 
.:: 
AddDefaultIdentity:: #
<::# $
	ECommUser::$ -
>::- .
(::. /
)::/ 0
.;; 
AddRoles;; 
<;; 
IdentityRole;; 
>;; 
(;; 
);; 
.<< $
AddEntityFrameworkStores<< 
<<<  
ApplicationDbContext<< 2
><<2 3
(<<3 4
)<<4 5
.== $
AddDefaultTokenProviders== 
(== 
)== 
;==  
builder?? 
.?? 
Services?? 
.?? 
	AddScoped?? 
<?? 
IUnitOfWork?? &
,??& '

UnitOfWork??( 2
>??2 3
(??3 4
)??4 5
;??5 6
varCC 
appCC 
=CC 	
builderCC
 
.CC 
BuildCC 
(CC 
)CC 
;CC 
ifFF 
(FF 
appFF 
.FF 
EnvironmentFF 
.FF 
IsDevelopmentFF !
(FF! "
)FF" #
)FF# $
{GG 
appHH 
.HH 

UseSwaggerHH 
(HH 
)HH 
;HH 
appII 
.II 
UseSwaggerUIII 
(II 
)II 
;II 
}JJ 
appLL 
.LL 
UseHttpsRedirectionLL 
(LL 
)LL 
;LL 
appNN 
.NN 
UseCorsNN 
(NN 
xNN 
=>NN 
xNN 
.OO 
AllowAnyMethodOO #
(OO# $
)OO$ %
.PP 
AllowAnyHeaderPP #
(PP# $
)PP$ %
.QQ 
SetIsOriginAllowedQQ '
(QQ' (
originQQ( .
=>QQ/ 1
trueQQ2 6
)QQ6 7
.SS 
AllowCredentialsSS %
(SS% &
)SS& '
)SS' (
;SS( )
appUU 
.UU 
UseAuthenticationUU 
(UU 
)UU 
;UU 
appWW 
.WW 
UseAuthorizationWW 
(WW 
)WW 
;WW 
appYY 
.YY 
MapControllersYY 
(YY 
)YY 
;YY 
app[[ 
.[[ 
Run[[ 
([[ 
)[[ 	
;[[	 
